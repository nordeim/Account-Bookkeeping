# Manual Testing Plan (v1) - Post-Journal Entry & Core Features Implementation

**Objective:** To manually verify the core functionalities implemented, including Application Setup, Settings, Chart of Accounts, Journal Entry lifecycle, GST F5 Return workflow, and Financial Report generation & export.

**Prerequisites:**
1.  A clean PostgreSQL database initialized with `scripts/schema.sql` and `scripts/initial_data.sql` (using `db_init.py`).
2.  `config.ini` correctly set up to point to this database with the `sgbookkeeper_user`.
3.  The application launched successfully (`poetry run sg_bookkeeper`).
4.  An 'admin' user (password: 'password', will be prompted to change) exists. It's recommended to change this password upon first successful login for realistic testing.

**Test Environment:**
*   OS: (Specify your OS)
*   Python Version: (Specify version, e.g., 3.12)
*   PostgreSQL Version: (Specify version, e.g., 14+)
*   Application Version: 1.0.0 (as per `main.py`)

**General Testing Notes:**
*   For each test case, record the "Actual Result" and mark "Pass/Fail".
*   Note any unexpected behavior, UI glitches, or error messages encountered.
*   Where "Verify in DB" is mentioned, use a tool like `psql` or pgAdmin to inspect the database tables.

---

## Test Suite 1: Application Startup, Login, and Basic Navigation

| Test ID | Description                       | Steps                                                                                                                                                              | Expected Result                                                                                                                                 | Actual Result | Pass/Fail |
| :------ | :-------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- | :------------ | :-------- |
| TS1.1   | Initial Startup & Login Prompt    | 1. Run `poetry run sg_bookkeeper`. <br> 2. Observe splash screen. <br> 3. (If first ever run with fresh DB for admin) Observe login prompt or default user state. | Splash screen appears. Application loads to main window. No `current_user` initially (or default auth attempt logs it). Status bar shows "Guest" or no user. |               |           |
| TS1.2   | Admin Login (First time)          | 1. If prompted for login, or if login is available via a menu: Try logging in as 'admin' with password 'password'. <br> 2. If prompted to change password, do so. | Successful login. Status bar updates to "User: admin". Access to features granted.                                                                |               |           |
| TS1.3   | Admin Login (Subsequent)          | 1. After changing password, log out (if option exists) and log back in with the new admin password.                                                                | Successful login with the new password.                                                                                                         |               |           |
| TS1.4   | Failed Login                      | 1. Attempt to log in with 'admin' and an incorrect password.                                                                                                       | Login fails. Appropriate error message displayed. `core.users.failed_login_attempts` increments.                                                |               |           |
| TS1.5   | Account Lockout (Conceptual)      | 1. Attempt to log in with 'admin' and incorrect password 5+ times. <br> 2. Attempt to log in with correct password.                                                | After 5 failed attempts, login with correct password should fail. `core.users.is_active` for admin becomes `false`. (Requires admin to unlock) |               |           |
| TS1.6   | Tab Navigation                    | 1. Click on each main tab (Dashboard, Accounting, Customers, Vendors, Banking, Reports, Settings).                                                                 | Each tab activates and displays its content (even if stubs for some). No errors during tab switching.                                           |               |           |
| TS1.7   | Clean Shutdown                    | 1. Close the application window. <br> 2. Confirm exit if prompted.                                                                                                 | Application closes cleanly. Console logs show graceful shutdown sequence. No errors.                                                          |               |           |

---

## Test Suite 2: Settings Module

| Test ID | Description                       | Steps                                                                                                                                                                                                                                   | Expected Result                                                                                                                                                              | Actual Result | Pass/Fail |
| :------ | :-------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------ | :-------- |
| TS2.1   | View Company Settings             | 1. Navigate to Settings tab. <br> 2. Observe Company Information fields.                                                                                                                                                              | Fields are populated with default data from `initial_data.sql` (e.g., "My Demo Company Pte. Ltd."). Base currency combo shows "SGD".                                       |               |           |
| TS2.2   | Modify & Save Company Settings    | 1. Change Company Name, UEN, GST Reg. No, Address. <br> 2. Change Base Currency (e.g., to USD, if available in combo). <br> 3. Change Fiscal Year Start Month/Day. <br> 4. Click "Save Company Settings". <br> 5. Restart app & re-check. | Success message. Changes are persisted (verify in UI after restart and directly in `core.company_settings` table). Audit log reflects changes by the logged-in user.         |               |           |
| TS2.3   | View Fiscal Years                 | 1. In Settings tab, go to Fiscal Year Management section.                                                                                                                                                                               | Table is initially empty (unless `initial_data.sql` creates one).                                                                                                            |               |           |
| TS2.4   | Add New Fiscal Year (Monthly)     | 1. Click "Add New Fiscal Year". <br> 2. Enter Name (e.g., "FY2024"), valid Start/End Dates (e.g., 01/01/2024 - 31/12/2024). <br> 3. Select "Monthly" for "Auto-generate Periods". <br> 4. Click OK.                                    | Success message. New FY appears in the list. 12 monthly `FiscalPeriod` records created in `accounting.fiscal_periods` for this FY, all "Open". Audit log records creation. |               |           |
| TS2.5   | Add New Fiscal Year (Quarterly)   | 1. Click "Add New Fiscal Year". <br> 2. Enter Name (e.g., "FY2025"), valid Start/End Dates (e.g., 01/07/2024 - 30/06/2025). <br> 3. Select "Quarterly". <br> 4. Click OK.                                                              | Success message. New FY appears. 4 quarterly `FiscalPeriod` records created, all "Open". Audit log.                                                                          |               |           |
| TS2.6   | Add New Fiscal Year (No Periods)  | 1. Click "Add New Fiscal Year". <br> 2. Enter Name "FY2026", Dates. <br> 3. Select "None" for periods. <br> 4. Click OK.                                                                                                            | Success message. New FY appears. No periods generated in `accounting.fiscal_periods` for this FY. Audit log.                                                                 |               |           |
| TS2.7   | Add FY - Name Conflict            | 1. Try to add a new FY with the same name as an existing one (e.g., "FY2024").                                                                                                                                                          | Error message: "Fiscal year with the name 'FY2024' already exists." No new FY created.                                                                                         |               |           |
| TS2.8   | Add FY - Date Overlap             | 1. Try to add a new FY whose date range overlaps with "FY2024" (e.g., 01/06/2024 - 31/05/2025).                                                                                                                                       | Error message: "The proposed date range overlaps with existing fiscal year 'FY2024'..." No new FY created.                                                                     |               |           |
| TS2.9   | Add FY - Invalid Dates            | 1. In FiscalYearDialog, set Start Date after End Date. Click OK.                                                                                                                                                                      | Validation error message: "End Date must be after Start Date." Dialog does not close.                                                                                        |               |           |

---

## Test Suite 3: Chart of Accounts Module

| Test ID | Description                       | Steps                                                                                                                                                                | Expected Result                                                                                                                                                              | Actual Result | Pass/Fail |
| :------ | :-------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------ | :-------- |
| TS3.1   | View Chart of Accounts            | 1. Navigate to Accounting tab -> Chart of Accounts.                                                                                                                  | Account tree displays accounts (initially from `initial_data.sql` if any, or empty if not). Toolbar with actions is visible.                                                  |               |           |
| TS3.2   | Add Root Account                  | 1. Click "Add Account". <br> 2. Enter Code (e.g., "9000"), Name "Test Root Asset", Type "Asset". <br> 3. Leave Parent ID as "None" (or 0). <br> 4. Click Save.          | Success message. New account appears in tree at root level for Assets. Verify in `accounting.accounts` table. Audit log.                                                    |               |           |
| TS3.3   | Add Child Account                 | 1. Select "Test Root Asset" (9000). <br> 2. Click "Add Account". <br> 3. Parent ID in dialog might pre-fill or need manual entry for ID of "9000". <br> 4. Enter Code "9010", Name "Child Asset", Type "Asset". Click Save. | Success message. "Child Asset" appears under "Test Root Asset". `parent_id` in DB is correct. Audit log.                                                                  |               |           |
| TS3.4   | Add Account with Opening Balance  | 1. Click "Add Account". <br> 2. Code "1115", Name "New Bank OB", Type "Asset", SubType "Cash and Cash Equivalents", Is Bank Account: True. OB: 500.00, OB Date: (today). Click Save. | Success. Account created. `opening_balance` and `opening_balance_date` stored in DB. OB Date field was enabled when OB was non-zero.                                        |               |           |
| TS3.5   | Edit Account                      | 1. Select "Child Asset" (9010). Click "Edit Account". <br> 2. Change Name to "Edited Child Asset", Description "Test desc". Click Save.                               | Success message. Changes reflected in tree and DB. `updated_at`, `updated_by_user_id` updated. Audit log.                                                                    |               |           |
| TS3.6   | Deactivate Active Account (No Bal)| 1. Ensure "Edited Child Asset" (9010) has no transactions and zero balance (including OB). <br> 2. Select it, click "Toggle Active". Confirm.                            | Success. Account marked inactive in tree (e.g., different color/style or "No" in Is Active column). `is_active=false` in DB. Audit log.                                      |               |           |
| TS3.7   | Activate Inactive Account         | 1. Select the now inactive "Edited Child Asset". Click "Toggle Active". Confirm.                                                                                     | Success. Account marked active again. `is_active=true` in DB. Audit log.                                                                                                     |               |           |
| TS3.8   | Deactivate Account (With Balance) | 1. Create/Edit an account to have a non-zero opening balance (e.g. "1115 New Bank OB"). <br> 2. Try to "Toggle Active" to deactivate it.                               | Error message: "Cannot deactivate account ... as it has a non-zero balance...". Account remains active.                                                                    |               |           |
| TS3.9   | Add Account - Code Conflict       | 1. Try to add a new account with an existing Code (e.g., "1115").                                                                                                      | Error message: "Account code '1115' already exists." Account not created.                                                                                                    |               |           |

---

## Test Suite 4: Journal Entry Module

| Test ID | Description                       | Steps                                                                                                                                                                                                                                                                                                                                                                                       | Expected Result                                                                                                                                                                                                                                                                                                                                                       | Actual Result | Pass/Fail |
| :------ | :-------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------ | :-------- |
| TS4.1   | View Journal Entries List         | 1. Navigate to Accounting -> Journal Entries.                                                                                                                                                                                                                                                                                                                                               | Table displays (initially empty, or with seeded entries). Filter controls visible. Toolbar actions (New, Edit, View, Post, Reverse) visible.                                                                                                                                                                                                                                       |               |           |
| TS4.2   | Create & Save Draft JE            | 1. Click "New Entry". <br> 2. Fill JE Dialog: Date (within an open FY/Period), Desc, Ref. <br> 3. Add 2 lines: <br>   - Line 1: Account (e.g., an Expense like "Rent Expense"), Debit 100. <br>   - Line 2: Account (e.g., "Main Bank Account SGD"), Credit 100. <br> 4. Verify Balance: OK. Click "Save Draft". | Success message. Dialog closes. New JE appears in list with "Draft" status and correct details (Entry No., Date, Desc, Total). Verify in `accounting.journal_entries` (`is_posted=false`) and `journal_entry_lines` tables. Audit log.                                                                                                                                            |               |           |
| TS4.3   | Create Unbalanced JE (Attempt)    | 1. Click "New Entry". <br> 2. Add Line 1: Debit 100. Add Line 2: Credit 50. <br> 3. Verify Balance: Out of Balance. <br> 4. Click "Save Draft" or "Save & Post".                                                                                                                                                                                                                             | Validation error message: "Journal entry is not balanced...". Dialog does not close. Entry not saved.                                                                                                                                                                                                                                                                     |               |           |
| TS4.4   | Edit Draft JE                     | 1. Select the draft JE from TS4.2. Click "Edit Draft". <br> 2. Change description. Modify amounts (keeping it balanced, e.g., Debit 150, Credit 150). <br> 3. Add a new line (balanced). <br> 4. Click "Save Draft".                                                                                                                                                                            | Success message. Dialog closes. JE list updates with changes. Verify in DB. Audit log for JE header and lines (if field-level history is active, or summary log reflects update).                                                                                                                                                                                                |               |           |
| TS4.5   | View Draft JE                     | 1. Select draft JE from TS4.2. Click "View Entry" (or double-click).                                                                                                                                                                                                                                                                                                                        | Dialog opens, populated. All fields should be editable (as it's a draft, though "View" implies read-only, current dialog makes drafts editable even in view mode). "Save Draft" / "Save & Post" buttons enabled. Window title "View Journal Entry".                                                                                                                              |               |           |
| TS4.6   | View Posted JE                    | 1. (After TS4.7) Select a posted JE. Click "View Entry".                                                                                                                                                                                                                                                                                                                                    | Dialog opens, populated. All fields are read-only. Save buttons hidden/disabled. Window title "View Journal Entry". Delete line buttons hidden.                                                                                                                                                                                                                              |               |           |
| TS4.7   | Post Draft JE                     | 1. Select draft JE from TS4.4. Click "Post Selected".                                                                                                                                                                                                                                                                                                                                        | Success message. Status in list changes to "Posted". `is_posted=true` in DB. Audit log.                                                                                                                                                                                                                                                                                   |               |           |
| TS4.8   | Attempt to Edit Posted JE         | 1. Select posted JE from TS4.7. Click "Edit Draft".                                                                                                                                                                                                                                                                                                                                         | "Edit Draft" button should be disabled. If somehow clicked, error message "Cannot update a posted journal entry..." or dialog opens read-only.                                                                                                                                                                                                                                      |               |           |
| TS4.9   | Reverse Posted JE                 | 1. Select posted JE from TS4.7. Click "Reverse Selected". <br> 2. Confirm reversal. <br> 3. Enter Reversal Date (today) and Description. Click OK.                                                                                                                                                                                                                                          | Success message. New "RJE-xxxx" entry (Draft) appears. Original JE (TS4.7) marked `is_reversed=true` and `reversing_entry_id` set in DB. Reversal JE has opposite debit/credit. Audit logs for both.                                                                                                                                                                      |               |           |
| TS4.10  | JE List Filtering                 | 1. Create several JEs with different dates, statuses, descriptions. <br> 2. Test Date Range filter. <br> 3. Test Status filter ("Draft", "Posted", "All"). <br> 4. Test Entry No. filter. <br> 5. Test Description filter. <br> 6. Test "Clear Filters".                                                                                                                                            | List updates correctly for each filter. "Clear Filters" resets to default view.                                                                                                                                                                                                                                                                                                   |               |           |
| TS4.11  | Create JE with Tax                | 1. Click "New Entry". <br> 2. Line 1: Account (e.g., Expense), Debit 100, Tax Code "TX (9%)". <br> 3. Line 2: Account (Bank), Credit (100 + Tax). <br> 4. Observe calculated Tax Amt on Line 1. Verify Balance: OK. <br> 5. Save Draft. | Tax Amt auto-calculates (e.g., 9.00). JE saves. `tax_code` and `tax_amount` stored in `journal_entry_lines`.                                                                                                                                                                                                                                                                     |               |           |

---

## Test Suite 5: GST F5 Return Preparation & Finalization (in Reports Widget)

| Test ID | Description                       | Steps                                                                                                                                                                                                                                                                                                                                                          | Expected Result                                                                                                                                                                                                                                                                                                                                                                        | Actual Result | Pass/Fail |
| :------ | :-------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------ | :-------- |
| TS5.1   | Prepare GST F5 Data (No Txns)     | 1. Navigate to Reports -> GST F5 Preparation. <br> 2. Select a date range with no posted JEs having GST codes. <br> 3. Click "Prepare GST F5 Data".                                                                                                                                                                                                            | Display fields show 0.00 for supplies, purchases, taxes. Filing Due Date calculated. "Save Draft" button enabled. `_prepared_gst_data` populated.                                                                                                                                                                                                                                      |               |           |
| TS5.2   | Prepare GST F5 Data (With Txns)   | 1. Ensure some JEs from TS4.11 (or similar with SR/TX codes) are POSTED within a specific period (e.g., last month). <br> 2. Select this period in GST F5 tab. Click "Prepare".                                                                                                                                                                                    | Display fields populate with calculated values for Standard-Rated Supplies, Taxable Purchases, Output Tax, Input Tax, Net GST Payable based on the JEs. `_prepared_gst_data` correctly populated.                                                                                                                                                                                           |               |           |
| TS5.3   | Save Draft GST Return             | 1. After TS5.2, click "Save Draft GST Return".                                                                                                                                                                                                                                                                                                                 | Success message "GST Return draft saved successfully (ID: X)". New record in `accounting.gst_returns` table with `status='Draft'` and correct data. `_saved_draft_gst_return_orm` populated in widget. "Finalize" button enabled.                                                                                                                                                          |               |           |
| TS5.4   | Re-prepare Data                   | 1. After TS5.3, change date range slightly and click "Prepare GST F5 Data" again.                                                                                                                                                                                                                                                                              | New data displayed. `_saved_draft_gst_return_orm` is cleared (or should be). "Save Draft" enabled, "Finalize" disabled (until new draft saved).                                                                                                                                                                                                                                       |               |           |
| TS5.5   | Finalize GST Return               | 1. After TS5.3 (successful draft save), click "Finalize GST Return". <br> 2. Enter Submission Ref (e.g., "IRAS123") and Submission Date (today). Click OK.                                                                                                                                                                                                        | Success message "GST Return finalized... Settlement JE ID: Y". `accounting.gst_returns` record updated: `status='Submitted'`, submission details filled, `journal_entry_id` linked to new settlement JE. A new JE is created and POSTED, clearing SYS-GST-OUTPUT/INPUT to GST-PAYABLE/RECEIVABLE. "Save Draft" & "Finalize" buttons disabled for this data. Audit log. |               |           |
| TS5.6   | Attempt to Finalize Unsaved Data  | 1. Prepare GST data (TS5.1 or TS5.2). Do NOT click "Save Draft". <br> 2. Click "Finalize GST Return".                                                                                                                                                                                                                                                            | "Finalize" button should be disabled. If somehow clicked, error message "Please save a draft GST return first."                                                                                                                                                                                                                                                                         |               |           |
| TS5.7   | Attempt to Finalize Submitted Rtn | 1. After TS5.5, try to click "Finalize GST Return" again (it should be disabled). If somehow enabled and clicked:                                                                                                                                                                                                                                                | Error message like "This GST Return ... is already 'Submitted'." or button remains disabled.                                                                                                                                                                                                                                                                                              |               |           |

---

## Test Suite 6: Financial Reports (in Reports Widget)

| Test ID | Description                | Steps                                                                                                                                                                                                           | Expected Result                                                                                                                                                                                                                                                                                           | Actual Result | Pass/Fail |
| :------ | :------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------ | :-------- |
| TS6.1   | Generate Balance Sheet     | 1. Ensure some accounts have balances (via JEs from TS4, or opening balances). <br> 2. Navigate to Reports -> Financial Statements. <br> 3. Select Report Type: "Balance Sheet". <br> 4. Set "As of Date". Click "Generate". | Report data displayed in `QTextEdit` (HTML format): Title, As of Date, Sections (Assets, Liabilities, Equity) with accounts and balances, Totals. "Export" buttons enabled. `_current_financial_report_data` populated.                                                                                      |               |           |
| TS6.2   | Generate P&L Statement     | 1. Ensure Revenue/Expense accounts have activity for a period. <br> 2. Select Report Type: "Profit & Loss Statement". <br> 3. Set "Period Start Date" and "Period End Date". Click "Generate".                    | Report data displayed: Title, Period Dates, Sections (Revenue, Expenses) with accounts and activity, Totals, Net Profit/Loss. "Export" buttons enabled.                                                                                                                                                     |               |           |
| TS6.3   | Generate Trial Balance     | 1. Use same data as TS6.1. <br> 2. Select Report Type: "Trial Balance". <br> 3. Set "As of Date". Click "Generate".                                                                                              | Report data displayed: Title, As of Date, Accounts listed with Debit/Credit balances. Totals for Debits & Credits. Balance check (Debits = Credits). "Export" buttons enabled.                                                                                                                              |               |           |
| TS6.4   | Dynamic Date Fields        | 1. Switch Report Type combo between "Balance Sheet", "P&L", "Trial Balance".                                                                                                                                    | Date input fields correctly show/hide: "As of Date" for BS/TB, "Period Start/End" for P&L.                                                                                                                                                                                                               |               |           |
| TS6.5   | Export Report to PDF       | 1. After generating any report (e.g., TS6.1), click "Export to PDF". <br> 2. `QFileDialog` appears. Choose save location and filename. Click Save.                                                              | PDF file is created at the chosen location. Content matches the on-screen display (basic formatting). Success message.                                                                                                                                                                                  |               |           |
| TS6.6   | Export Report to Excel     | 1. After generating any report, click "Export to Excel". <br> 2. `QFileDialog` appears. Choose save location and filename. Click Save.                                                                           | Excel (.xlsx) file is created. Content matches on-screen display (basic formatting). Success message.                                                                                                                                                                                                      |               |           |
| TS6.7   | Export Before Generating   | 1. Without generating a report first, click "Export to PDF" or "Export to Excel".                                                                                                                             | Buttons should be disabled. If somehow clicked, a message "Please generate a report first..." appears. No file dialog.                                                                                                                                                                                   |               |           |

